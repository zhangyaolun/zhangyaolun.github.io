new Vue({el:"#app",data:{headerEdit:!0,headerTitle:"编辑",JSeditShowTitle:!0,JSeditShowhide:!1,checkAll_checked:!1,preLoading:!0,mainEmpty:!0,JSlistShow:!0,subTitle:0,subShow:!0,JSeditShow:-1,dialogWrapper:!1,shopList:[],addCheckNum:[],addCheckPrice:[],addCheckId:[],delChecked:[],delMoreChecked:[],_thisAttr:[],_thisTrue:{count:0,id:"",selected:!1,skuId:""}},computed:{allmoney:function(){var s=this,o=0;return s.addCheckPrice&&s.addCheckPrice.forEach(function(t,e){o+=t*parseInt(s.addCheckNum[e])}),o?(parseInt(o)/100).toFixed(2)+"元":"0.00"}},watch:{shopList:{handler:function(t,e){},deep:!0}},mounted:function(){FastClick.attach(document.body),commentJs.toastLoading("购物车数据读取中..."),commentJs.headerFooter(3);var t=this;setTimeout(function(){t.oListData()},10)},filters:{currency:function(t){return t?(parseInt(t)/100).toFixed(2):"0.00"},subTitleCurrency:function(t){return"去结算("+t+")"}},methods:{inputblur:function(t,e,s){var c=this,i=[],d={count:"",id:"",selected:!1,skuId:""};if(!/^[1-9]\d*$/.test(t.count)){t.count=1,d.count=1,d.id=t.id,d.selected=t.selected,d.skuId=t.skuId,i.push(d);o.shopcarUpCargo(i,function(t){c.allcheckedInput(),c.addproductNum(),c.shopCarNum()})}},inputChange:function(t,e,s){var c=this,i=[],d=!1,n={count:"",id:"",selected:!1,skuId:""};if(/^[1-9]\d*$/.test(t.count)?(t.count>t.sku.stock||256<t.count)&&(256<t.sku.stock?t.count=256:t.count=t.sku.stock,commentJs.toastTitle("数量超出范围","forbidden")):t.count?t.count=t.count.substring(0,t.count.length-1):d=!0,n.count=t.count?t.count:"",n.id=t.id,n.selected=t.selected,n.skuId=t.skuId,i.push(n),!d){o.shopcarUpCargo(i,function(t){c.allcheckedInput(),c.addproductNum(),c.shopCarNum()})}},oListData:function(){var s=this;o.shopcarAll(function(t){if(0!=t.result.length){$("body").removeClass("bgf"),s.mainEmpty=!0,s.headerEdit=!0;var e=t.result;e.forEach(function(t,e){var d=!0,n=0;t.cargoList.forEach(function(t,e){if(t.oldcount=t.count,0==t.sku.stock||null==t.sku.stock||"null"==t.sku.stock||"DownShelf"==t.product.status){if(t.disabledInput=!0,t.disabledInputTitle="无货",t.selected){var s=[],c={count:1,id:t.id,selected:!1,skuId:t.skuId},i=function(){};s.push(c),o.shopcarUpCargo(s,i)}t.selected=!1}else t.disabledInput=!1;"DownShelf"==t.product.status&&(t.disabledInputTitle="下架",t.selected&&(s=[],c={count:1,id:t.id,selected:!1,skuId:t.skuId},i=function(){},s.push(c),o.shopcarUpCargo(s,i)),t.selected=!1),t.disabledInput||(n=1,t.selected)||(d=!1)}),1==n&&(t.seller.selected=d)}),s.shopList=JSON.parse(JSON.stringify(e)),s.addproductNum(),s.allcheckedInput()}else $("body").addClass("bgf"),s.mainEmpty=!1,s.headerEdit=!1;s.preLoading=!1})},JSedit:function(t){var e=this;e.JSlistShow=!e.JSlistShow,e.JSeditShow=t;var s=$(".nctouch-cart-container .JS-edit").eq(t).html();$(".nctouch-cart-container .JS-edit").html("编辑"),"编辑"==s?$(".nctouch-cart-container .JS-edit").eq(t).html("完成"):($(".nctouch-cart-container .JS-edit").eq(t).html("编辑"),e.JSeditShow=-1),"完成"==s&&e.shopList[t].cargoList.forEach(function(t,e){/^[1-9]\d*$/.test(t.count)||(t.count&&(t.count=t.count.substring(0,t.count.length-1)),t.count||(t.count=t.oldcount))})},reduceChang:function(t,e,s){var c=this;if(!(t.count<2)){t.count--;var i=c.shopList[s].cargoList;t.oldcount=t.count;var d={count:t.count,id:t.id,selected:!0,skuId:t.skuId},n=[];if(t.selected=!0,n.push(d),i[e].selected){o.shopcarUpCargo(n,function(t){c.checkedInput(s)})}else c.changList(e,s),c.addproductNum()}},plusChang:function(t,e,s){var c=this,i=c.shopList[s].cargoList;if(t.count++,t.count>t.sku.stock||256<t.count)return 256<=t.sku.stock?(t.count=256,t.oldcount=256):(t.count=t.sku.stock,t.oldcount=t.count),void commentJs.toastTitle("数量超出范围","forbidden");t.selected=!0,t.oldcount=t.count;var d={count:t.count,id:t.id,selected:!0,skuId:t.skuId},n=[];if(n.push(d),i[e].selected){o.shopcarUpCargo(n,function(t){c.checkedInput(s)})}else c.changList(e,s),c.addproductNum()},changChecke:function(c){var i=this;i.shopList[c].seller.selected=!i.shopList[c].seller.selected,i._thisAttr=[],i.preLoading=!0,commentJs.toastLoading("更新中...");for(var t=0,e=i.shopList[c].cargoList.length;t<e;t++)i.shopList[c].cargoList[t].disabledInput||(i.shopList[c].seller.selected?i._thisTrue={count:i.shopList[c].cargoList[t].count,id:i.shopList[c].cargoList[t].id,selected:!0,skuId:i.shopList[c].cargoList[t].skuId}:i._thisTrue={count:i.shopList[c].cargoList[t].count,id:i.shopList[c].cargoList[t].id,selected:!1,skuId:i.shopList[c].cargoList[t].skuId},i._thisAttr.push(i._thisTrue));o.shopcarUpCargo(i._thisAttr,function(t){for(var e=0,s=i.shopList[c].cargoList.length;e<s;e++)i.shopList[c].seller.selected?i.shopList[c].cargoList[e].disabledInput?i.shopList[c].cargoList[e].selected=!1:i.shopList[c].cargoList[e].selected=!0:i.shopList[c].cargoList[e].selected=!1;i.preLoading=!1,i.allcheckedInput(),i.addproductNum()})},changList:function(e,s){var o=this,c=o.shopList[s].cargoList;if(!c[e].disabledInput){o.shopcarUp(e,s,function(t){c[e].selected=!c[e].selected,o.checkedInput(s),o.preLoading=!1})}},checkAll:function(){var i=this;i.checkAll_checked=!i.checkAll_checked,i._thisAttr=[],i.preLoading=!0,commentJs.toastLoading("更新中...");for(var t=0,e=i.shopList.length;t<e;t++){i.checkAll_checked?i.shopList[t].seller.selected=!0:i.shopList[t].seller.selected=!1;for(var s=0,c=i.shopList[t].cargoList.length;s<c;s++)i.shopList[t].cargoList[s].disabledInput||(i.checkAll_checked?i._thisTrue={count:i.shopList[t].cargoList[s].count,id:i.shopList[t].cargoList[s].id,selected:!0,skuId:i.shopList[t].cargoList[s].skuId}:i._thisTrue={count:i.shopList[t].cargoList[s].count,id:i.shopList[t].cargoList[s].id,selected:!1,skuId:i.shopList[t].cargoList[s].skuId},i._thisAttr.push(i._thisTrue))}o.shopcarUpCargo(i._thisAttr,function(t){for(var e=0,s=i.shopList.length;e<s;e++){i.checkAll_checked?i.shopList[e].seller.selected=!0:i.shopList[e].seller.selected=!1;for(var o=0,c=i.shopList[e].cargoList.length;o<c;o++)i.checkAll_checked?i.shopList[e].cargoList[o].disabledInput?i.shopList[e].cargoList[o].selected=!1:i.shopList[e].cargoList[o].selected=!0:i.shopList[e].cargoList[o].selected=!1}i.preLoading=!1,i.allcheckedInput(),i.addproductNum()}),i.allcheckedInput(),i.addproductNum()},checkedInput:function(t){for(var e=!0,s=this,o=0,c=s.shopList[t].cargoList.length;o<c;o++)s.shopList[t].cargoList[o].disabledInput||s.shopList[t].cargoList[o].selected||(e=!1);s.shopList[t].seller.selected=!!e,s.allcheckedInput(),s.addproductNum()},allcheckedInput:function(){for(var t=!0,e=0,s=this,o=0,c=s.shopList.length;o<c;o++)for(var i=0,d=s.shopList[o].cargoList.length;i<d;i++)s.shopList[o].cargoList[i].disabledInput||(e=1,s.shopList[o].cargoList[i].selected||(t=!1));1==e&&(s.checkAll_checked=!!t)},addproductId:function(){this.addCheckId=[],this.addCheckNum=[],this.addCheckPrice=[],this.delMoreChecked=[];var s=this;s.shopList.forEach(function(t,e){t.cargoList.forEach(function(t,e){t.selected&&(s.addCheckId.push(t.skuId),s.delMoreChecked.push(t.id),s.addCheckPrice.push(t.price),s.addCheckNum.push(t.count))})})},addproductNum:function(){var s=this;s.subTitle=0,s.addproductId(),s.addCheckNum.forEach(function(t,e){s.subTitle=parseInt(s.subTitle)+parseInt(t)})},headerClick:function(){var t=this;"编辑"==t.headerTitle?(t.headerTitle="完成",t.JSeditShowTitle=!1,t.JSeditShowhide=!0,t.subShow=!1):(t.headerTitle="编辑",t.JSeditShowTitle=!0,t.JSeditShowhide=!1,t.JSeditShow=-1,t.subShow=!0,$(".nctouch-cart-container .JS-edit").html("编辑"),t.addproductNum())},dialogWrapperClick:function(t){console.log(t),this.dialogWrapper=!0,this.delChecked=[],this.delChecked.push(t)},btnCancel:function(){this.dialogWrapper=!1},btnTrue:function(){var c=this;if(0<c.delChecked.length){var t=function(t){c.shopList.forEach(function(s,t){s.cargoList.forEach(function(t,e){t.id==c.delChecked[0]&&s.cargoList.splice(e,1)})}),c.delChecked=[],commentJs.toastTitle("删除成功",""),c.dialogWrapper=!1,c.shopCarSeller(),c.shopCarNum()};o.shopcardel(c.delChecked,t)}else{t=function(t){c.delMoreChecked.forEach(function(o,t){c.shopList.forEach(function(s,t){s.cargoList.forEach(function(t,e){t.id==o&&s.cargoList.splice(e,1)})})}),commentJs.toastTitle("删除成功",""),c.shopCarSeller(),c.dialogWrapper=!1,c.shopCarNum()};o.shopcardel(c.delMoreChecked,t)}c.allcheckedInput(),c.addproductNum()},btnMoreDel:function(){this.dialogWrapper=!0},payMent:function(){0!=this.subTitle?(sessionStorage.setItem("orderNum",1),window.location.href="shopOrder.html?subType=Carog"):commentJs.toastTitle("请选择商品","forbidden")},shopcarUp:function(t,e,s){var c=this,i=c.shopList[e].cargoList;c._thisAttr=[],c._thisTrue={count:i[t].count,id:i[t].id,selected:!i[t].selected,skuId:i[t].skuId},c._thisAttr.push(c._thisTrue),c.preLoading=!0,commentJs.toastLoading("更新中..."),o.shopcarUpCargo(c._thisAttr,s)},shopCarNum:function(){for(var t=0,e=0,s=this.shopList.length;e<s;e++)for(var o=0,c=this.shopList[e].cargoList.length;o<c;o++)t+=parseInt(this.shopList[e].cargoList[o].count);commentJs.setCookie("shopNum",t,1)},shopCarSeller:function(){var t=this;console.log(t.shopList.length);for(var e=0,s=t.shopList.length;e<s;e++)t.shopList[e]&&0==t.shopList[e].cargoList.length&&t.shopList.splice(e,1);0==t.shopList.length&&(t.mainEmpty=!1,t.headerEdit=!1)},DownShelfClick:function(t,e){window.location.href="OnShelf"==e?"../product/product_detail.html?goods_id="+t:"../member/shopLower.html"}}});