new Vue({el:"#list",data:{searchBarFixed:!1,codeBarFixed:!1,codeBarFixedc:!1,codeBarFixedf:!1,codeBarFixedj:!1,header_navFalg:0,shopCarNum:0,shopCarFalg:!1,miaoshaShow:!1,favorateFalg:!1,headerTabShow:!0,detailSpec:!0,preLoading:!0,swiperList:[],detailList:{},goods_hair_info:{},common_price:"",miaosha_start_time:"",descriptionImage:"",area_name:"",sellerName:"",skuCombinationDescription:"",buyBtnNum:1,seachTitle:"",datas:{count:1,skuId:""},spuName:"",shopSave:{collectType:"1",collectId:1},miaosha_end_time:"",shopData:{name:"",img:"",price:"",stock:"",setStock:0},stockFalg:!1,subFalg:!0,stockFalg2:!0,fictitiousType:null,miaoshafictitiousType:!1,addShopGoodsNum:0,addShopGoodsFalg:!0,shopLowerFalg:!1,qrcodeImg:"",codeData:{shareUserId:null,receiveUserId:null,productId:null,productLink:null}},computed:{fenqi_price:function(){var t=(this.detailList.promotion_price?this.detailList.promotion_price:this.detailList.goods_price)/12;return t="NaN"==t||"Infinity"==t?"0.00":t.toFixed(2)}},mounted:function(){var t=this;FastClick.attach(document.body);var o=commentJs.getUrlKey("code")||"";if(o||sessionStorage.getItem("userId")){if(o){commentJs.automaticLogin(o,function(){t.onefun()})}else t.onefun();window.addEventListener("scroll",t.handleScroll)}},filters:{priceTofixed:function(t){return t?(parseInt(t)/100).toFixed(2):"0.00"},priceTofixeds:function(t){return t?(parseInt(t)/100).toFixed(2):"0.00"},common_stock:function(t){return 0<t||""!=t?"有货":"无货"},volume:function(t){return t||0}},methods:{onefun:function(){var s=this;setTimeout(function(){s.area_name=sessionStorage.getItem("cityName")||"上海浦东城区政立路",s.shopCarNum=commentJs.getCookie("shopNum"),0<s.shopCarNum?s.shopCarFalg=!0:s.shopCarFalg=!1;var t=commentJs.getUrlKey("spikeProductId"),o=commentJs.getUrlKey("goods_id"),a=commentJs.getUrlKey("binding")||null;a&&(s.codeData.shareUserId=a,s.codeData.receiveUserId=sessionStorage.getItem("userId")?sessionStorage.getItem("userId").split("|")[2]:null,s.codeData.productId=o||(t||null),s.codeData.productLink=window.location.href,s.wxbinding()),commentJs.toastLoading("加载中..."),s.seachTitle=commentJs.gethotNew(),setTimeout(function(){s.oBackTop(),s.spikeoListData(t),s.oListData(o)},10)},200)},wxbinding:function(){o.wxBinding(this.codeData,function(t){})},codeclick:function(){var t=this;t.codeBarFixedf=!1,t.qrcodeImg="http://e-shop.ecache.com.cn/productInfo/shareImg/"+t.datas.skuId+"/"+sessionStorage.getItem("userId").split("|")[0],t.codeBarFixed=!0,t.codeBarFixedc=!0,commentJs.stop()},codeclickf:function(){var t=this;t.codeBarFixedf=!0,t.codeBarFixed=!0,t.codeBarFixedc=!1,commentJs.stop()},btnClose:function(){this.codeBarFixed=!1,this.codeBarFixedc=!1,this.codeBarFixedf=!1,this.codeBarFixedj=!1,commentJs.move()},codeclickff:function(){this.codeBarFixed=!1,this.codeBarFixedc=!1,this.codeBarFixedf=!1,this.codeBarFixedj=!0,commentJs.stop()},inputblur:function(){/^[1-9]\d*$/.test(this.datas.count)||(this.datas.count=1)},inputChange:function(){var t=this;/^[1-9]\d*$/.test(t.datas.count)?1==t.buyBtnNum?256<=t.shopData.stock&&1!=t.datas.count?parseFloat(t.datas.count)+parseFloat(t.addShopGoodsNum)>parseFloat(t.shopData.stock)&&(t.datas.count=256-t.addShopGoodsNum):parseFloat(t.datas.count)+parseFloat(t.addShopGoodsNum)>parseFloat(t.shopData.stock)&&1!=t.datas.count&&(t.datas.count=t.shopData.stock-t.addShopGoodsNum<=0?1:t.shopData.stock-t.addShopGoodsNum):(t.datas.count>parseFloat(t.shopData.stock)||256<t.datas.count)&&(256<=t.shopData.stock?t.datas.count=256:t.datas.count=t.shopData.stock):t.datas.count=t.datas.count.substring(0,t.datas.count.length-1)},addGoods:function(t,a){if("null"!=t&&t&&"null"!=a&&a){var s=this;s.addShopGoodsNum=0;o.shopcarAll(function(t){t.result.forEach(function(t,o){t.cargoList.forEach(function(t,o){t.sku.id!=a||(s.addShopGoodsNum=t.count)})})})}},oBackTop:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0},oListData:function(s){if("null"!=s&&s){var i=this;o.productDetailId(s,function(t){if(200==t.httpCode){var o=t.result;i.detailList=o,i.descriptionImage=i.detailList.spuList[0].spuAttrList[0].descriptionImage,i.shopSave.collectId=i.detailList.id,i.shopData.name=i.detailList.name,i.shopData.img=i.detailList.mainPic,i.shopData.price=i.detailList.price,0<i.shopData.stock||""!=i.shopData.stock?(i.stockFalg2=!0,i.stockFalg=!0):(i.stockFalg2=!1,i.stockFalg=!1),i.skuCombinationDescription="",i.detailList.spuList.forEach(function(t,o){i.skuCombinationDescription+=t.titile+": "+t.spuAttrList[0].description+" ",t.spuAttrList[0].defaults=!0}),i.collSeach(),i.detailList.spuList.forEach(function(t,o){i.spuName+=t.titile+" "}),i.detailList.fictitious&&1==i.detailList.fictitiousType?(i.stockFalg2=!1,i.stockFalg=!0,i.miaoshafictitiousType=!0,i.fictitiousType=i.detailList.fictitiousType):commentJs.addFootprintSave(s),i.miaoshaShow=!1;var a=[];a[0]=o.mainPic,i.swiperList=i.swiperList.concat(a),o.pics&&0<o.pics.replace(/\[|]/g,"").length&&(i.swiperList=i.swiperList.concat(o.pics.replace(/\[|]/g,"").split(","))),i.detailList.seller&&(i.sellerName=i.detailList.seller.shopName),i.spuAttrClick(0,0),commentJs.onMenuShareDetail(o.name,o.mainPic,1,s),setTimeout(function(){new Swiper(".swiper-container",{loop:!0,pagination:".swiper-pagination",paginationType:"fraction"}),i.preLoading=!1,i.shopLowerFalg=!1},10)}else i.preLoading=!1,i.shopLowerFalg=!0})}},spikeoListData:function(n){if("null"!=n&&n){var d=this;o.spikeActivityDetail(n,function(t){if(200==t.httpCode){var o=t.result;d.detailList=o,d.shopSave.collectId=o.id,d.datas.skuId=o.id,d.sellerName=d.detailList.productInfo.shopName,d.shopData.name=d.detailList.productInfo.name,d.shopData.img=d.detailList.productInfo.mainPic,d.shopData.price=d.detailList.activityPrice,d.shopData.stock=d.detailList.activityStock,d.stockFalg2=!1,0==d.shopData.stock?d.stockFalg=!1:d.stockFalg=!0,d.miaoshafictitiousType=!0,d.skuCombinationDescription=d.detailList.productInfo.skuName,d.collSeach();var a=commentJs.getUrlKey("time");if(commentJs.onMenuShareDetail(d.shopData.name,d.shopData.img,2,n,a),a){var s=a.split("|"),i=(new Date).getTime(),e=s[1];d.miaoshaShow=!0,parseInt(e)<i?(d.stockFalg2=!1,d.stockFalg=!1,commentJs.toastTitle("限时活动已结束","forbidden")):(d.miaosha_start_time=e,d.miaosha_end_time=parseInt(s[1]),setTimeout(function(){commentJs.fnTimeCountDown()},10))}var c=[];c[0]=o.productInfo.mainPic,d.swiperList=c,o.productInfo.pics&&0<o.productInfo.pics.replace(/\[|]/g,"").length&&(d.swiperList=d.swiperList.concat(o.productInfo.pics.replace(/\[|]/g,"").split(","))),setTimeout(function(){new Swiper(".swiper-container",{loop:!0,pagination:".swiper-pagination",paginationType:"fraction"}),d.preLoading=!1,d.shopLowerFalg=!1},10)}else d.preLoading=!1,d.shopLowerFalg=!0})}},handleScroll:function(){var a=this;$(window).scroll(function(){var t=$(this).scrollTop(),o=$(document).height();550<t?(a.searchBarFixed=!0,a.headerTabShow=!1,a.header_navFalg=1):(a.headerTabShow=!0,a.searchBarFixed=!1),o-900<t&&(a.searchBarFixed=!0,a.headerTabShow=!1,a.header_navFalg=2),t<100&&(a.searchBarFixed=!1,a.headerTabShow=!0)})},buyBtn:function(t,o){this.buyBtnNum=t,(this.stockFalg2||this.stockFalg)&&(this.miaoshaShow&&1==t||this.fictitiousType&&1==t||this.addCart())},detailClose:function(t){this.detailSpec=!0},favorateFun:function(){var a=this;if(a.favorateFalg){o.collectionDelete(a.shopSave,function(t){a.favorateFalg=!1,commentJs.toastTitle("已取消收藏",""),sessionStorage.removeItem("a")})}else{o.collectionSave(a.shopSave,function(t){a.favorateFalg=!0,commentJs.toastTitle("收藏成功",""),sessionStorage.removeItem("a")})}commentJs.shopCollNum()},reduceChang:function(){this.datas.count<=1||this.datas.count--},plusChang:function(){var t=this;if(t.datas.count++,1==t.buyBtnNum){if((t.datas.count+t.addShopGoodsNum>t.shopData.stock||256<t.datas.count+t.addShopGoodsNum)&&1!=t.datas.count)return t.datas.count=t.shopData.stock-t.addShopGoodsNum<=0?1:256<=t.shopData.stock?256-t.addShopGoodsNum:t.shopData.stock-t.addShopGoodsNum,void commentJs.toastTitle("数量超出范围","forbidden")}else if(256<=t.shopData.stock){if(256<t.datas.count)return t.datas.count=256,void commentJs.toastTitle("数量超出范围","forbidden")}else if(t.datas.count>t.shopData.stock)return t.datas.count=t.shopData.stock,void commentJs.toastTitle("数量超出范围","forbidden")},addCart:function(){var a=this,s=!1;if(a.subFalg)if(1==a.buyBtnNum){if(a.shopData.setStock<=0)return void commentJs.toastTitle("数量超出范围","forbidden");if(a.detailList.spuList.forEach(function(t,o){t.spuAttrList.forEach(function(t,o){t.defaults&&(s=!0)})}),s){o.shopcarAdd(a.datas.skuId,a.datas.count,function(t){a.shopCarNum=parseInt(a.shopCarNum)+parseInt(a.datas.count),commentJs.shopcarAll(),a.shopCarFalg=!0,a.shopData.setStock--,a.addShopGoodsNum++,commentJs.toastTitle("加入购物车成功",""),a.detailSpec=!0,commentJs.shopFly()})}else commentJs.toastTitle("请选择规格","forbidden")}else a.payCart()},MapCityClick:function(){var o=this;commentJs.areaSelected({hideThirdLevel:!0,success:function(t){o.area_name=t.area_info}})},spuAttrClick:function(t,o){var a=this,s="";a.detailList.spuList[o].spuAttrList.forEach(function(t,o){t.defaults=!1}),a.detailList.spuList[o].spuAttrList[t].defaults=!a.detailList.spuList[o].spuAttrList[t].defaults,a.detailList.spuList.forEach(function(t,o){t.spuAttrList.forEach(function(t,o){t.defaults&&(s+=t.id+",")})}),s="["+(s=s.substring(0,s.length-1))+"]",a.detailList.skuList.forEach(function(t,o){t.skuCombination==s?(a.datas.skuId=t.id,t.skuCombinationImage?a.shopData.img=t.skuCombinationImage:a.shopData.img=a.detailList.mainPic,a.shopData.price=t.price,a.shopData.stock=t.stock,a.addGoods(t.productId,t.id)):a.shopData.stock=0}),a.shopData.setStock=256<=a.shopData.stock?256-a.addShopGoodsNum:a.shopData.stock-a.addShopGoodsNum,0<a.shopData.stock||""!=a.shopData.stock?(a.subFalg=!0,a.stockFalg2=!0,a.stockFalg=!0):(a.subFalg=!1,a.stockFalg2=!1,a.stockFalg=!1),a.datas.count=1,a.detailList.fictitious&&1==a.detailList.fictitiousType&&(a.stockFalg2=!1)},collSeach:function(){var a=this;o.collectionSeach(a.shopSave,function(t){a.favorateFalg=t.result})},payCart:function(){var t=this,o="";t.datas.skuId?(t.miaoshaShow&&(o="&orderType=Spike"),1==t.fictitiousType&&(o="&orderType=Fictitious&fictitiousType=1"),sessionStorage.setItem("orderNum",1),window.location.href="../shop/shopOrder.html?subType=SKU"+o+"&linkId="+t.datas.skuId+"&count="+t.datas.count+o):commentJs.toastTitle("选择 "+t.spuName,"forbidden")}}});