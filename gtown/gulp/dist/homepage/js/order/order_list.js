new Vue({el:"#app",data:{oBackTopFixed:!1,curFalg:1,M_X_falg:!1,oMtabList:["全部订单","待付款","待发货","待收货"],oMtabFlag:0,oMitemList:[],order_none:!1,oFitemList:[],orderF_none:!1,preLoading:!0,oXtabList:[],oXtabFlag:0,odatas:{orderState:null,fictitious:!1,keyword:""},page:1,count:10,odatasState:[0,"Submit","Pay","Delivering"],dialogWrapper:!1,oid:"",delData:{id:"",i:""},diaTitle:"确认删除吗？",falgDel:!1},computed:{},filters:{orderCurrency:function(t){return t?{Submit:"待付款",Pay:"待发货",Delivering:"待收货",Reject:"退货",Refund:"退款",Cancel:"已取消",Received:"已完成"}[t]:""},currency:function(t){return t?"¥"+(parseInt(t)/100).toFixed(2):"¥0.00"}},mounted:function(){var t=this;FastClick.attach(document.body),commentJs.homeHader("我的订单","../member/member.html"),commentJs.toastLoading("加载中..."),commentJs.BackToTop("fix-block-r");var e=commentJs.getUrlKey("title");0==e?(t.oMtabFlag=1,t.odatas.orderState="Submit"):1==e?(t.oMtabFlag=2,t.odatas.orderState="Pay"):2==e&&(t.oMtabFlag=3,t.odatas.orderState="Delivering");var a=commentJs.getUrlKey("fictitiousType")||null,o=sessionStorage.getItem("curFalg")||1;(null!=a&&"null"!=a||2==o)&&(t.curFalg=2,t.odatas.fictitious=!0,t.M_X_falg=!0),setTimeout(function(){t.oListData()},10),window.addEventListener("scroll",t.handleScroll)},methods:{headerTab:function(t){var e=this;t!=e.curFalg&&(e.curFalg=t,e.odatas.fictitious=1!=t,e.M_X_falg=!e.M_X_falg,e.page=1,e.odatas.keyword="",e.preLoading=!0,e.oMitemList=[],setTimeout(function(){e.oListData()},10))},oMtabClick:function(t){var e=this;e.oMtabFlag=t,e.odatas.orderState=0==t?null:e.odatasState[t],e.page=1,e.oListData()},oListData:function(){var i=this;i.preLoading=!0;var t=i.odatas.keyword;0==i.oMtabFlag&&1==i.curFalg?i.odatas={fictitious:!1,keyword:t}:0==i.oXtabFlag&&2==i.curFalg&&(i.preLoading=!1,i.odatas={fictitious:!0,keyword:t,orderState:""});o.userOrder(i.page,i.count,i.odatas,function(t){1==i.page&&1==i.curFalg&&(i.oMitemList=[]),0<t.result.list.length?($("body").removeClass("bgf"),i.order_none=!1,i.orderF_none=!1,t.result.list.forEach(function(t,e){if(0!=t.orderProduct.length&&t.seller){var a=0;t.orderProduct.forEach(function(t,e){a+=parseInt(t.count)}),t.oNum=a,i.oMitemList.push(t)}}),""==i.oMitemList&&(i.order_none=!0,i.orderF_none=!0)):($("body").addClass("bgf"),1==i.page&&(i.order_none=!0,i.orderF_none=!0)),i.preLoading=!1})},confirmOrder:function(t){var e=this;o.userOrderConfirm(t,function(t){e.page=1,commentJs.toastTitle("收货成功",""),setTimeout(function(){e.oListData()},10)})},payOrder:function(a){var i=this;o.wxpayorderNumber(a,function(t){var e=t.result;i.preLoading=!1,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(t){"get_brand_wcpay_request:ok"==t.err_msg?window.location.href="../shop/payOrder.html?orderNumber="+a+"&fictitiousType=1":"get_brand_wcpay_request:cancel"==t.err_msg||(window.location.href="../shop/payOrder.html?orderNumber="+a+"&fictitiousType=0")})})},order_Confirm:function(t,e){var a=this;a.delData.id=t,a.delData.i=e,a.diaTitle="您是否已收到此订单商品吗？",a.dialogWrapper=!0},order_Delid:function(t,e){var a=this;a.delData.id=t,a.delData.i=e,a.diaTitle="确认取消吗？",a.dialogWrapper=!0},btnMoreDel:function(t,e){var a=this;a.delData.id=t,a.delData.i=e,a.diaTitle="确认删除吗？",a.dialogWrapper=!0},btnCancel:function(){this.dialogWrapper=!1,this.falgDel=!1},order_Delete:function(){var e=this;e.falgDel||(e.falgDel=!0,e.dialogWrapper=!1,setTimeout(function(){if("确认删除吗？"==e.diaTitle){var t=function(t){e.falgDel=!1,commentJs.toastTitle("删除成功",""),e.oMitemList.splice(e.delData.i,1)};o.userOrderDelete(e.delData.id,t)}else if("您是否已收到此订单商品吗？"==e.diaTitle){t=function(t){e.page=1,commentJs.toastTitle("收货成功",""),setTimeout(function(){e.falgDel=!1,e.oListData()},10)};o.userOrderConfirm(e.delData.id,t)}else if("确认取消吗？"==e.diaTitle){t=function(t){e.page=1,commentJs.toastTitle("取消成功",""),setTimeout(function(){e.falgDel=!1,e.oListData()},10)};o.userOrderCancel(e.delData.id,t)}},10))},oXtabClick:function(t){var e=this;e.oXtabFlag=t,e.orderF_none=0!=t,e.page=1,e.oListData()},oBackTop:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0},handleScroll:function(){var t=this;$(window).height()+$(document).scrollTop()==$(document).height()&&(t.page++,t.oListData());var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;t.oBackTopFixed=100<e}}});