new Vue({el:"#app",data:{oBackTopFixed:!1,curFalg:1,M_X_falg:!1,oMtabList:["全部订单","待付款","待发货","待收货"],oMtabFlag:0,oMitemList:[],order_none:!1,oFitemList:[],orderF_none:!1,preLoading:!0,oXtabList:[],oXtabFlag:0,odatas:{orderState:null,fictitious:!1,keyword:""},page:1,count:10,odatasState:[0,"Submit","Pay","Delivering"],dialogWrapper:!1,oid:"",delData:{id:"",i:""},diaTitle:"确认删除吗？",falgDel:!1},computed:{},filters:{orderCurrency:function(e){return e?{Submit:"待付款",Pay:"待发货",Delivering:"待收货",Reject:"退货",Refund:"退款",Cancel:"已取消",Received:"已完成"}[e]:""},currency:function(e){return e?"¥"+(parseInt(e)/100).toFixed(2):"¥0.00"}},mounted:function(){var e=this;FastClick.attach(document.body),commentJs.homeHader("我的订单","../member/member.html"),commentJs.toastLoading("加载中..."),commentJs.BackToTop("fix-block-r");var t=commentJs.getUrlKey("title");0==t?(e.oMtabFlag=1,e.odatas.orderState="Submit"):1==t?(e.oMtabFlag=2,e.odatas.orderState="Pay"):2==t&&(e.oMtabFlag=3,e.odatas.orderState="Delivering");var a=commentJs.getUrlKey("fictitiousType")||null,o=sessionStorage.getItem("curFalg")||1;(null!=a&&"null"!=a||2==o)&&(e.curFalg=2,e.odatas.fictitious=!0,e.M_X_falg=!0),setTimeout(function(){e.oListData()},10),window.addEventListener("scroll",e.handleScroll)},methods:{headerTab:function(e){var t=this;e!=t.curFalg&&(t.curFalg=e,t.odatas.fictitious=1!=e,t.M_X_falg=!t.M_X_falg,t.page=1,t.odatas.keyword="",t.preLoading=!0,t.oMitemList=[],setTimeout(function(){t.oListData()},10))},oMtabClick:function(e){var t=this;t.oMtabFlag=e,t.odatas.orderState=0==e?null:t.odatasState[e],t.page=1,t.oListData()},oListData:function(){var i=this;i.preLoading=!0;var e=i.odatas.keyword;0==i.oMtabFlag&&1==i.curFalg?i.odatas={fictitious:!1,keyword:e}:0==i.oXtabFlag&&2==i.curFalg&&(i.preLoading=!1,i.odatas={fictitious:!0,keyword:e,orderState:""});o.userOrder(i.page,i.count,i.odatas,function(e){1==i.page&&1==i.curFalg&&(i.oMitemList=[]),0<e.result.list.length?($("body").removeClass("bgf"),i.order_none=!1,i.orderF_none=!1,e.result.list.forEach(function(e,t){if(0!=e.orderProduct.length&&e.seller){var a=0;e.orderProduct.forEach(function(e,t){a+=parseInt(e.count)}),e.oNum=a,i.oMitemList.push(e)}}),""==i.oMitemList&&(i.order_none=!0,i.orderF_none=!0)):($("body").addClass("bgf"),1==i.page&&(i.order_none=!0,i.orderF_none=!0)),i.preLoading=!1})},confirmOrder:function(e){var t=this;o.userOrderConfirm(e,function(e){t.page=1,commentJs.toastTitle("收货成功",""),setTimeout(function(){t.oListData()},10)})},payOrder:function(a){var i=this;o.wxpayorderNumber(a,function(e){var t=e.result;i.preLoading=!1,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:"MD5",paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?window.location.href="../shop/payOrder.html?orderNumber="+a+"&fictitiousType=1":"get_brand_wcpay_request:cancel"==e.err_msg||(window.location.href="../shop/payOrder.html?orderNumber="+a+"&fictitiousType=0")})})},order_Confirm:function(e,t){var a=this;a.delData.id=e,a.delData.i=t,a.diaTitle="您是否已收到此订单商品吗？",a.dialogWrapper=!0},order_Delid:function(e,t){var a=this;a.delData.id=e,a.delData.i=t,a.diaTitle="确认取消吗？",a.dialogWrapper=!0},btnMoreDel:function(e,t){var a=this;a.delData.id=e,a.delData.i=t,a.diaTitle="确认删除吗？",a.dialogWrapper=!0},btnCancel:function(){this.dialogWrapper=!1,this.falgDel=!1},order_Delete:function(){var t=this;if(!t.falgDel)if(t.falgDel=!0,"确认删除吗？"==t.diaTitle){var e=function(e){t.dialogWrapper=!1,t.falgDel=!1,commentJs.toastTitle("删除成功",""),t.oMitemList.splice(t.delData.i,1)};o.userOrderDelete(t.delData.id,e)}else if("您是否已收到此订单商品吗？"==t.diaTitle){e=function(e){t.page=1,t.dialogWrapper=!1,commentJs.toastTitle("收货成功",""),setTimeout(function(){t.falgDel=!1,t.oListData()},10)};o.userOrderConfirm(t.delData.id,e)}else{e=function(e){t.page=1,t.dialogWrapper=!1,commentJs.toastTitle("取消成功",""),setTimeout(function(){t.falgDel=!1,t.oListData()},10)};o.userOrderCancel(t.delData.id,e)}},oXtabClick:function(e){var t=this;t.oXtabFlag=e,t.orderF_none=0!=e,t.page=1,t.oListData()},oBackTop:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0},handleScroll:function(){var e=this;$(window).height()+$(document).scrollTop()==$(document).height()&&(e.page++,e.oListData());var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;e.oBackTopFixed=100<t}}});