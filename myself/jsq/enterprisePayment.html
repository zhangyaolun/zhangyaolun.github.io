<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>仁仕通上海社保计算器</title>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<script>
	        document.getElementsByTagName("html")[0].style.fontSize=window.screen.width/10+"px";
	    </script>
	</head>
	<body><!--fddc01 -->
		<script src="./js/fastclick.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/vue.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/echarts.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/data.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/index.js" type="text/javascript" charset="utf-8"></script>
		<div id="app" v-cloak class="w100">
			
			<div class="person_item w100 center clear">
				<div class="personItem_l">
					<div class="per_l_maoney">￥<span>{{moneys}}</span>{{moneyo}}</div>
					<div class="per_title">企业缴纳</div>
				</div>
				<div class="personItem_r">
					<div class="per_r_title"><span>{{occupation}}</span>%</div>
					<div class="per_title">占总缴纳数比例</div>
				</div>
			</div>
			
			<div class="person_main_box">
				<div class="per_main_top">企业/{{money | currency}}</div>
				<ul>
					<li class="clear" v-for="item in list">
						<span class="left">{{item.name}}</span>
						<div class="right">
							<span>{{item.tax}}</span>
							<i></i>
							<div>{{item.value}}</div>
						</div>
					</li>
				</ul>
			</div>
			
			<div class="person_Explain">
				<div>本服务由仁仕通提供</div> 
				<div>咨询热线：<span>400-101-6131</span></div>
			</div>
			
			
			<div class="pre-loading" v-show="preLoading">
				<div class="pre-block"><div class="spinner"><i></i></div>数据加载中...</div>
			</div>
		</div>
		<script type="text/javascript">
			new Vue({
			    el: '#app',
			    data: {
			    	preLoading:true,//加载
			        inputVal:0,//输入值
			        money:0,//企业总缴纳
			        occupation:0,//企业占比
			        moneys:0,//小数点之前
			        moneyo:0,//小数点之后
			        list:[]
			    },
			    filters: {
			        currency: function (value) {
			            return value?(parseFloat(value)).toFixed(2):'0.00';
			        },
			    },
			    mounted: function () {
			        var _this = this;
			        FastClick.attach(document.body);
			        _this.inputVal = sessionStorage.getItem('inputVal')*1;
			        var moremoney = sessionStorage.getItem('moremoney')*1;
			        if(!_this.inputVal)return;
			        _this.money = 0;

			        _this.list = o[0].enterprisePayment;
			        _this.list.forEach(function(m,n){
		        		m.value = (parseFloat(m.tax)/100*_this.inputVal).toFixed(2);
			        	_this.money = parseFloat(m.value) + parseFloat(_this.money);
			        })
			        var _m = _this.money.toFixed(2).toString().split('.');
			        _this.moneys = _m[0];
			        _this.moneyo = '.'+_m[1];
			        _this.occupation = ((_this.money/moremoney)*100).toFixed(0);
			        
			    	setTimeout(function(){_this.preLoading = false;},100) 
			        
			    },
			    methods: {
			        thTypeClick: function (index) {//个人 企业切换查看点击
			            var _this = this;
			            this.showHideFalg == index?this.showHideFalg = 3:this.showHideFalg = index;
			            if(this.showHideFalg == 1){
			            	document.getElementById('mainBox').innerHTML = '<div id="main" class="mt"></div><div id="mains" class="mt"></div>';
			            	_this.echarts();
							_this.echartsT();
			            }else{
			            	if(document.getElementById('main')){
			            		document.getElementById('main').remove();
			            		document.getElementById('mains').remove();
			            	}
			            }
			        },
			        echarts:function(){//优化前收入与支出占比
			        	var _this = this;
			        	var myChart = echarts.init(document.getElementById('main'));
						var option = {
							title: { //标题组件，包含主标题和副标题。
								text: '优化前收入与支出占比',//主标题文本，支持使用 \n 换行。
								top:'bottom',
            					left:'center',
							},
				            series: [
				                {
				                    name:'',
				                    type:'pie',
				                    radius: ['30%', '90%'],
				                    label: {
				                        normal: {
				                            position:'inside',
				                            formatter: "{b} \n {c}元 ",
				                            align:'center',
				                            fontSize: 15,
				                            color:"#fff"
				                        }
				                    },
				                    data:[
				                        {value:0, name:'员工社保个税:'},//个人社保缴纳汇总+个人所得税
				                        {value:0, name:'单位社保交金:'},//单位社保缴纳汇总
				                        {value:0, name:'员工到手收入:'}//税后收入
				                    ]
				                },
				                {
				                    name:'',
				                    type:'pie',
				                    radius: ['0%', '33%'],
				                    label: {
				                        normal: {
				                            position: 'center',
				                    		formatter: "{b} \n {c}元 ",
				                            fontSize: 18,
				                            color:'#80F0E3'
				                        }
				                    },
				                    data:[
				                        {value:0, name:'单位总支出'}
				                    ]
				                }
				            ],
				        };
				        option.series[0].data[0].value = (_this.itemList[0].oldvalue*1 + _this.taxFun(_this.inputVal)).toFixed(2);
				        option.series[0].data[1].value = (_this.itemList[1].oldvalue*1).toFixed(2);
				        option.series[0].data[2].value = (_this.inputVal - option.series[0].data[0].value).toFixed(2);
				        option.series[1].data[0].value = (_this.inputVal*1 + _this.itemList[1].oldvalue*1).toFixed(2);
				        myChart.setOption(option);
			        },
			        echartsT:function(){//仁仕通优化后收入与支出占比
			        	var _this = this;
			        	var myChart = echarts.init(document.getElementById('mains'));
						var option = {
							title: { //标题组件，包含主标题和副标题。
								text: '仁仕通优化后收入与支出占比',//主标题文本，支持使用 \n 换行。
								top:'bottom',
            					left:'center',
							},
				            series: [
				                {
				                    name:'',
				                    type:'pie',
				                    radius: ['30%', '90%'],
				                    label: {
				                        normal: {
				                            position:'inside',
				                            formatter: "{b} \n {c}元 ",
				                            align:'center',
				                            fontSize: 15,
				                            color:"#fff"
				                        }
				                    },
				                    data:[
				                        {value:0, name:'员工社保个税:'},//个人社保缴纳汇总+个人所得税
				                        {value:0, name:'单位社保交金:'},//单位社保缴纳汇总
				                        {value:0, name:'员工到手收入:'}//税后收入
				                    ]
				                },
				                {
				                    name:'',
				                    type:'pie',
				                    radius: ['0%', '33%'],
				                    label: {
				                        normal: {
				                            position: 'center',
				                    		formatter: "{b} \n {c}元 ",
				                            fontSize: 18,
				                            color:'#80F0E3'
				                        }
				                    },
				                    data:[
				                        {value:0, name:'单位总支出'}
				                    ]
				                }
				            ],
				        };
				        option.series[0].data[0].value = (_this.itemList[0].value*1 + _this.taxFun(_this.inputVal)).toFixed(2);
				        option.series[0].data[1].value = (_this.itemList[1].value*1).toFixed(2);
				        option.series[0].data[2].value = (_this.inputVal - option.series[0].data[0].value).toFixed(2);
				        option.series[1].data[0].value = (_this.inputVal*1 + _this.itemList[1].value*1).toFixed(2);
				        myChart.setOption(option);
			        },
			        taxFun:function(val){//个人所得税
			        	/*
				         * <=5000             5   0
				         * 5000  < - <=12000  10%  210
				         * 12000 < - <=25000  20%  1410
				         * 25000 < - <=35000  25%  2660
				         * 35000 < - <=55000  30%  4410
				         * 55000 < - <=80000  35%  7160
				         * >80000             45%  15160
				         * */
				        var _tax = 0;
				        if(parseFloat(val) <= 5000){
				        	console.log('09')
				        	_tax = (this.inputVal)*0.05;
				        }else if(5000 < parseFloat(val) && parseFloat(val) <= 12000){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.1 - 210;
				        }else if(12000 < parseFloat(val) && parseFloat(val) <= 25000){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.2 - 1410;
				        }else if(25000 < parseFloat(val) && parseFloat(val) <= 35000){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.25 - 2660;
				        }else if(35000 < parseFloat(val) && parseFloat(val) <= 55000){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.30 - 4410;
				        }else if(55000 < parseFloat(val) && parseFloat(val) <= 80000){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.35 - 7160;
				        }else if(80000 < parseFloat(val)){
				        	console.log('09')
				        	_tax = (this.inputVal - 5000)*0.45 - 15160;
				        }
				        return _tax;
			        }
			    }
			})
		</script>
	</body>
</html>
