<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>仁仕通上海社保计算器</title>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<script>
	        document.getElementsByTagName("html")[0].style.fontSize=window.screen.width/10+"px";
	    </script>
	</head>
	<body><!--fddc01 -->
		<script src="./js/fastclick.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/vue.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/echarts.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/data.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/index.js" type="text/javascript" charset="utf-8"></script>
		<div id="app" v-cloak class="w100">
			
			<div class="th_item w100 center">
				<div class="pt7">总共缴纳</div>
				<div class="title">(个人缴纳+企业缴纳)</div>
				<div class="money"><span>￥</span> {{money | currency}}</div>
			</div>
			
			<div class="th_main_box w100 bgf boxShadow">
				<div class="thMain" v-for="(item,index) in itemList">
					<div class="thMain_type clear" :class="[index==0?'borderBot':'']" @click="thTypeClick(index)">
						<div class="left">
							<img :src="item.img" alt=""class="icon_l" />
							<span class="imgMiddle ml">{{item.title}}</span>
							<span class="imgMiddle">{{item.value}}</span>
						</div>
						<img src="img/p3.png" alt="" class="right icon"/>
					</div>
				</div>
			</div>
			<div id="mainBox">
				<div class="title">优化前收入与支出占比</div>
				<div id="main"></div>
			</div>
			<div id="mainBoxs">
				<div class="titles">仁仕通优化后收入与支出占比</div>
				<div id="mains"></div>
			</div>
			<div class="pre-loading" v-show="preLoading">
				<div class="pre-block"><div class="spinner"><i></i></div>数据加载中...</div>
			</div>
		</div>
		<script type="text/javascript">
			new Vue({
			    el: '#app',
			    data: {
			    	preLoading:true,//加载
			        money:0,//总共缴纳
			        showHideFalg:3,//个人缴纳与企业缴纳 0个人 1企业
			        newVal:0,//工资
			        inputVal:0,//优化后工资
			        oldVal:0,//优化前
			        personVal:0,//个人所得税优化后
			        personValold:0,//个人所得税优化前
			        itemList:[
			        	{
			        		title:'个人缴纳:',
			        		value:0,
			        		old:0,
			        		img:'./img/p1.png',
			        		list:[]
			        	},
			        	{
			        		title:'企业缴纳:',
			        		value:0,
			        		old:0,
			        		img:'./img/p2.png',
			        		list:[]
			        	}
			        ]
			    },
			    filters: {
			        currency: function (value) {
			            return value?(parseFloat(value)).toFixed(2):'0.00';
			        },
			    },
			    mounted: function () {
			        var _this = this;
			        FastClick.attach(document.body);
			        _this.newVal = sessionStorage.getItem('inputVal')*1;
			        _this.inputVal = _ss(sessionStorage.getItem('inputVal')*1);
			        _this.oldVal = _sss(sessionStorage.getItem('inputVal')*1);
			        if(!_this.inputVal)return;
			        _this.money = 0;
			        _this.itemList[0].list = o[0].personalPayment;
			        _this.itemList[1].list = o[0].enterprisePayment;
			        _this.itemList.forEach(function(v,k){
			        	v.value = 0;
			        	v.old = 0;
			        	v.list.forEach(function(m,n){
			        		m.value = (parseFloat(m.tax)/100*_this.inputVal).toFixed(2);
			        		v.value = parseFloat(m.value) + parseFloat(v.value);
			        		v.old = (parseFloat(m.tax)/100*_this.oldVal) + parseFloat(v.old);
			        	})
			        	v.value = v.value.toFixed(2);
			        	_this.money = parseFloat(v.value) + parseFloat(_this.money);
			        })
			        _this.personVal = _this.taxFun(_this.inputVal,1).toFixed(2);
			        _this.personValold = _this.taxFun(_this.oldVal,2).toFixed(2);
			        _this.echarts();
					_this.echartsT();
			    	setTimeout(function(){_this.preLoading = false;},100) 
			    },
			    methods: {
			        thTypeClick: function (index) {//个人 企业切换查看点击
			            var _this = this,_url='';
			            index==0?_url='./personalPayment.html':_url='./enterprisePayment.html';
			            sessionStorage.setItem('moremoney',parseFloat(_this.money).toFixed(2));
			            window.location.href = _url;
			        },
			        echarts:function(){//仁仕通优化后收入与支出占比
			        	var _this = this;
			        	var myChart = echarts.init(document.getElementById('mains'));
						var option = {
						    series: [
						        {
						            name:'',
						            type:'pie',
						            radius: [0, '35%'],
						            hoverAnimation:false,
						            label: {
						                normal: {
						                    color:['#fff'],
						                    formatter: _this.get,
						                    position: 'center',
						                    rich: {
						                        b: {
						                            color:[''],
						                            fontSize: 10
						                        }
						                    }
						                }
						            },
						            labelLine: {
						                normal: {
						                    show: false
						                }
						            },
						            color:['#7cacda'],
						            data:[
						                {value:(_this.newVal*1 + _this.itemList[1].value*1).toFixed(2), name:'企业总支出'}
						            ]
						        },
						        {
						            name:'',
						            type:'pie',
						            radius: ['40%', '60%'],
						            hoverAnimation:false,
						            labelLine: {
						                normal: {
						                    length:5
						                }
						            },
						            label: {
						                normal: {
						                    formatter: _this.get,
						                    color:['#333'],
						                    rich: {
						                        b: {
						                            color:[''],
						                            fontSize: 10
						                        }
						                    }
						                }
						            },
						            data:[
						                {value:_this.itemList[0].value*1 + _this.personVal*1, name:'员工社保个税'},
						                {value:(_this.newVal/1000)*15, name:''},
						                {value:(_this.itemList[1].value*1).toFixed(2), name:'企业社保交金'},
						                {value:(_this.newVal/1000)*15, name:''},
						                {value:_this.newVal - (_this.itemList[0].value*1 +_this.personVal*1), name:'员工到手收入'},
						                {value:(_this.newVal/1000)*15, name:''},
						            ],
						            color:['#9bc3f6','rgba(0,0,0,0)','#9dbadc','rgba(0,0,0,0)','#c9d6e6','rgba(0,0,0,0)']
						        }
						    ]
				       };
				        myChart.setOption(option);
			        },
			        echartsT:function(){//优化前收入与支出占比
			        	var _this = this;
			        	var myChart = echarts.init(document.getElementById('main'));
						var option = {
						    series: [
						        {
						            name:'',
						            type:'pie',
						            radius: [0, '35%'],
						            label: {
						                normal: {
						                    color:['#fff'],
						                    formatter: _this.get,
						                    position: 'center',
						                    rich: {
						                        b: {
						                            color:[''],
						                            fontSize: 10
						                        }
						                    }
						                }
						            },
						            hoverAnimation:false,
						            labelLine: {
						                normal: {
						                    show: false,
						                    length:5
						                }
						            },
						            color:['#7cacda'],
						            data:[
						                {value:(_this.oldVal*1 + _this.itemList[1].old*1).toFixed(2), name:'企业总支出'}
						            ]
						        },
						        {
						            name:'',
						            type:'pie',
						            radius: ['40%', '60%'],
						            hoverAnimation:false,
						            labelLine: {
						                normal: {
						                    length:5
						                }
						            },
						            label: {
						                normal: {
						                    formatter: _this.get,
						                    color:['#333'],
						                    rich: {
						                        b: {
						                            color:[''],
						                            fontSize: 10
						                        }
						                    }
						                }
						            },
						            data:[
						                {value:_this.itemList[0].old*1 + _this.personValold*1, name:'员工社保个税'},
						                {value:(_this.oldVal/1000)*15, name:''},
						                {value:(_this.itemList[1].old*1).toFixed(2), name:'企业社保交金'},
						                {value:(_this.oldVal/1000)*15, name:''},
						                {value:_this.oldVal - (_this.itemList[0].old*1 +_this.personValold*1), name:'员工到手收入'},
						                {value:(_this.oldVal/1000)*15, name:''},
						            ],
						            color:['#9bc3f6','rgba(0,0,0,0)','#9dbadc','rgba(0,0,0,0)','#c9d6e6','rgba(0,0,0,0)'],
						            
						        }
						    ]
				        };
				        myChart.setOption(option);
			        },
			        taxFun:function(val,type){//个人所得税
			        	var _this = this;
				        var _val = 0;
				        type==1?_val=_this.itemList[0].value:_val=_this.itemList[0].old;
				        var _tax = 0;
				        if(parseFloat(val) < 5000){
				        	_tax = (parseFloat(val) - _val)*0.05;
				        }else if(5000 < parseFloat(val) && parseFloat(val) <= 12000){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.1 - 210;
				        }else if(12000 < parseFloat(val) && parseFloat(val) <= 25000){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.2 - 1410;
				        }else if(25000 < parseFloat(val) && parseFloat(val) <= 35000){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.25 - 2660;
				        }else if(35000 < parseFloat(val) && parseFloat(val) <= 55000){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.30 - 4410;
				        }else if(55000 < parseFloat(val) && parseFloat(val) <= 80000){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.35 - 7160;
				        }else if(80000 < parseFloat(val)){
				        	_tax = (parseFloat(val) - 5000 - _val)*0.45 - 15160;
				        }
				        return _tax;
			        },
			        get:function(e){
			        	if(e.name){
			        		return e.name+"\n"+e.value+"元";
			        	}
			        },
			    }
			})
		</script>
	</body>
</html>

