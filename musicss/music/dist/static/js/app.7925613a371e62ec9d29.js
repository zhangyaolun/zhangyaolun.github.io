webpackJsonp([1],{NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("7+uW"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=i("VU/8")({name:"App"},o,!1,function(e){i("vGjf")},null,null).exports,r=i("/ocq"),a=i("Zrlr"),c=i.n(a),d=i("wxAW"),u=i.n(d),h=function(){var e=2,t=[];self.onmessage=function(i){"encode"===i.data[0]?function(i){for(var n=i.length,o=new Uint8Array(n*e),s=0;s<n;s++){var r=s*e,a=i[s];a>1?a=1:a<-1&&(a=-1),a*=32768,o[r]=a,o[r+1]=a>>8}t.push(o)}(i.data[1]):"dump"===i.data[0]?function(i){var n=t.length?t[0].length:0,o=t.length*n,s=new Uint8Array(44+o),r=new DataView(s.buffer);r.setUint32(0,1380533830,!1),r.setUint32(4,36+o,!0),r.setUint32(8,1463899717,!1),r.setUint32(12,1718449184,!1),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,i,!0),r.setUint32(28,i*e,!0),r.setUint16(32,e,!0),r.setUint16(34,8*e,!0),r.setUint32(36,1684108385,!1),r.setUint32(40,o,!0);for(var a=0;a<t.length;a++)s.set(t[a],a*n+44);t=[];var c=[s.buffer];postMessage(c,[c[0]])}(i.data[1]):"close"===i.data[0]&&self.close()}},l=function(){var e=1,t=128,i=null,n=1152,o=[];function s(e){var t=new Float32Array(e),i=new Int16Array(e.length);return function(e,t){for(var i=0;i<e.length;i++){var n=Math.max(-1,Math.min(1,e[i]));t[i]=n<0?32768*n:32767*n}}(t,i),i}onmessage=function(r){var a,c;"encode"===r.data[0]?function(e){for(var t=s(e),r=t.length,a=0;r>=0;a+=n){var c=t.subarray(a,a+n),d=i.encodeBuffer(c);o.push(d),r-=n}}(r.data[1]):"dump"===r.data[0]?(r.data[1],(c=i.flush()).length>0&&o.push(c),postMessage(o),o=[]):"init"===r.data[0]?(a=r.data[1],importScripts(a.baseUrl+"/workers/encoders/lame.min.js"),i=new lamejs.Mp3Encoder(e,a.sampleRate,t)):"close"===r.data[0]&&self.close()}},p=function(){var e=1,t=.4,i=null,n=[];onmessage=function(o){var s,r,a,c;"encode"===o.data[0]?(a=o.data[1],c=i.encode([a]),n.push(c)):"dump"===o.data[0]?(o.data[1],r=i.finish("audio/ogg"),postMessage(r),n=[]):"init"===o.data[0]?(s=o.data[1],importScripts(s.baseUrl+"/workers/encoders/OggVorbisEncoder.js"),i=new OggVorbisEncoder(s.sampleRate,e,t)):"close"===o.data[0]&&self.close()}},m=function(){function e(t){c()(this,e),this.baseUrl=t,window.AudioContext=window.AudioContext||window.webkitAudioContext,this.em=document.createDocumentFragment(),this.state="inactive",this.chunks=[],this.chunkType="",this.usingMediaRecorder=window.MediaRecorder||!1,this.encoderMimeType="audio/wav",this.config={broadcastAudioProcessEvents:!1,createAnalyserNode:!1,createDynamicsCompressorNode:!1,forceScriptProcessor:!1,manualEncoderId:"wav",micGain:1,processorBufferSize:2048,stopTracksAndCloseCtxWhenFinished:!0,userMediaConstraints:{audio:!0}}}return u()(e,[{key:"createWorker",value:function(e){var t=e.toString().replace(/^function\s*\(\)\s*{/,"").replace(/}$/,""),i=new Blob([t]);return new Worker(URL.createObjectURL(i))}},{key:"startRecording",value:function(e){var t=this;if("inactive"===this.state){if(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return this.audioCtx=new AudioContext,this.micGainNode=this.audioCtx.createGain(),this.outputGainNode=this.audioCtx.createGain(),this.config.createDynamicsCompressorNode&&(this.dynamicsCompressorNode=this.audioCtx.createDynamicsCompressor()),this.config.createAnalyserNode&&(this.analyserNode=this.audioCtx.createAnalyser()),(this.config.forceScriptProcessor||this.config.broadcastAudioProcessEvents||!this.usingMediaRecorder)&&(this.processorNode=this.audioCtx.createScriptProcessor(this.config.processorBufferSize,1,1)),this.audioCtx.createMediaStreamDestination?this.destinationNode=this.audioCtx.createMediaStreamDestination():this.destinationNode=this.audioCtx.destination,this.usingMediaRecorder||("mp3"===this.config.manualEncoderId?(this.encoderWorker=this.createWorker(l),this.encoderWorker.postMessage(["init",{baseUrl:BASE_URL,sampleRate:this.audioCtx.sampleRate}]),this.encoderMimeType="audio/mpeg"):"ogg"===this.config.manualEncoderId?(this.encoderWorker=this.createWorker(p),this.encoderWorker.postMessage(["init",{baseUrl:BASE_URL,sampleRate:this.audioCtx.sampleRate}]),this.encoderMimeType="audio/ogg"):(this.encoderWorker=this.createWorker(h),this.encoderMimeType="audio/wav"),this.encoderWorker.addEventListener("message",function(e){var i=new Event("dataavailable");"ogg"===t.config.manualEncoderId?i.data=e.data:i.data=new Blob(e.data,{type:t.encoderMimeType}),t._onDataAvailable(i)})),navigator.mediaDevices.getUserMedia(this.config.userMediaConstraints).then(function(i){t._startRecordingWithStream(i,e)}).catch(function(e){alert("Error with getUserMedia: "+e.message),console.log(e)});alert("Missing support for navigator.mediaDevices.getUserMedia")}}},{key:"setMicGain",value:function(e){this.config.micGain=e,this.audioCtx&&this.micGainNode&&this.micGainNode.gain.setValueAtTime(e,this.audioCtx.currentTime)}},{key:"_startRecordingWithStream",value:function(e,t){var i=this;this.micAudioStream=e,this.inputStreamNode=this.audioCtx.createMediaStreamSource(this.micAudioStream),this.audioCtx=this.inputStreamNode.context,this.onGraphSetupWithInputStream&&this.onGraphSetupWithInputStream(this.inputStreamNode),this.inputStreamNode.connect(this.micGainNode),this.micGainNode.gain.setValueAtTime(this.config.micGain,this.audioCtx.currentTime);var n=this.micGainNode;this.dynamicsCompressorNode&&(this.micGainNode.connect(this.dynamicsCompressorNode),n=this.dynamicsCompressorNode),this.state="recording",this.processorNode?(n.connect(this.processorNode),this.processorNode.connect(this.outputGainNode),this.processorNode.onaudioprocess=function(e){return i._onAudioProcess(e)}):n.connect(this.outputGainNode),this.analyserNode&&n.connect(this.analyserNode),this.outputGainNode.connect(this.destinationNode),this.usingMediaRecorder?(this.mediaRecorder=new MediaRecorder(this.destinationNode.stream),this.mediaRecorder.addEventListener("dataavailable",function(e){return i._onDataAvailable(e)}),this.mediaRecorder.addEventListener("error",function(e){return i._onError(e)}),this.mediaRecorder.start(t)):(this.outputGainNode.gain.setValueAtTime(0,this.audioCtx.currentTime),t&&(console.log("Time slicing without MediaRecorder is not yet supported. The resulting recording will not be playable."),this.slicing=setInterval(function(){"recording"===this.state&&this.encoderWorker.postMessage(["dump",this.context.sampleRate])},t)))}},{key:"_onAudioProcess",value:function(e){this.config.broadcastAudioProcessEvents&&this.em.dispatchEvent(new CustomEvent("onaudioprocess",{detail:{inputBuffer:e.inputBuffer,outputBuffer:e.outputBuffer}})),this.usingMediaRecorder||"recording"===this.state&&(this.config.broadcastAudioProcessEvents?this.encoderWorker.postMessage(["encode",e.outputBuffer.getChannelData(0)]):this.encoderWorker.postMessage(["encode",e.inputBuffer.getChannelData(0)]))}},{key:"stopRecording",value:function(){"inactive"!==this.state&&(this.usingMediaRecorder?(this.state="inactive",this.mediaRecorder.stop()):(this.state="inactive",this.encoderWorker.postMessage(["dump",this.audioCtx.sampleRate]),clearInterval(this.slicing)))}},{key:"_onDataAvailable",value:function(e){if(this.chunks.push(e.data),this.chunkType=e.data.type,"inactive"===this.state){var t=new Blob(this.chunks,{type:this.chunkType}),i=URL.createObjectURL(t),n={ts:(new Date).getTime(),blobUrl:i,mimeType:t.type,size:t.size};this.chunks=[],this.chunkType=null,this.destinationNode&&(this.destinationNode.disconnect(),this.destinationNode=null),this.outputGainNode&&(this.outputGainNode.disconnect(),this.outputGainNode=null),this.analyserNode&&(this.analyserNode.disconnect(),this.analyserNode=null),this.processorNode&&(this.processorNode.disconnect(),this.processorNode=null),this.encoderWorker&&(this.encoderWorker.postMessage(["close"]),this.encoderWorker=null),this.dynamicsCompressorNode&&(this.dynamicsCompressorNode.disconnect(),this.dynamicsCompressorNode=null),this.micGainNode&&(this.micGainNode.disconnect(),this.micGainNode=null),this.inputStreamNode&&(this.inputStreamNode.disconnect(),this.inputStreamNode=null),this.config.stopTracksAndCloseCtxWhenFinished&&(this.micAudioStream.getTracks().forEach(function(e){return e.stop()}),this.micAudioStream=null,this.audioCtx.close(),this.audioCtx=null),this.em.dispatchEvent(new CustomEvent("recording",{detail:{recording:n}}))}}},{key:"_onError",value:function(e){console.log("error",e),this.em.dispatchEvent(new Event("error")),alert("error:"+e)}}]),e}(),g=new(function(){function e(){c()(this,e)}return u()(e,[{key:"humanFileSize",value:function(e,t){var i=t?1e3:1024;if(Math.abs(e)<i)return e+" B";var n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do{e/=i,++o}while(Math.abs(e)>=i&&o<n.length-1);return e.toFixed(1)+" "+n[o]}},{key:"isIosSafari",value:function(){return navigator.userAgent.match(/iP(od|hone|ad)/)&&navigator.userAgent.match(/AppleWebKit/)&&!navigator.userAgent.match(/(Cr|Fx|OP)iOS/)}}]),e}()),f={name:"HelloWorld",filters:{fileSizeToHumanSize:function(e){return g.humanFileSize(e,!0)}},data:function(){return{recordingInProgress:!1,supportedMimeTypes:[],recordings:[],micGainSlider:100,micGain:1,cleanupWhenFinished:!0,addDynamicsCompressor:!1}},created:function(){var e=this;this.recorderSrvc=new m,this.recorderSrvc.em.addEventListener("recording",function(t){return e.onNewRecording(t)})},watch:{cleanupWhenFinished:function(e){this.recorderSrvc.config.stopTracksAndCloseCtxWhenFinished=this.cleanupWhenFinished},micGainSlider:function(){this.micGain=(.01*this.micGainSlider).toFixed(2),this.recorderSrvc.setMicGain(this.micGain)}},methods:{startRecording:function(){var e=this;this.recorderSrvc.config.stopTracksAndCloseCtxWhenFinished=this.cleanupWhenFinished,this.recorderSrvc.config.createDynamicsCompressorNode=this.addDynamicsCompressor,this.recorderSrvc.startRecording().then(function(){e.recordingInProgress=!0}).catch(function(e){console.error("Exception while start recording: "+e),alert("Exception while start recording: "+e.message)})},stopRecording:function(){this.recorderSrvc.stopRecording(),this.recordingInProgress=!1},onNewRecording:function(e){console.log(e),this.recordings.push(e.detail.recording)}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{on:{click:e.startRecording}},[e._v("\n  \t开始\n  ")]),e._v(" "),i("br"),e._v(" "),i("div",{on:{click:e.stopRecording}},[e._v("\n  \t停止\n  ")]),e._v(" "),i("br"),e._v(" "),e._l(e.recordings,function(e,t){return i("div",{key:e.ts},[i("audio",{attrs:{src:e.blobUrl,controls:"true"}})])})],2)},staticRenderFns:[]};var N=i("VU/8")(f,v,!1,function(e){i("YbIk")},null,null).exports;n.a.use(r.a);var y=new r.a({routes:[{path:"/",name:"HelloWorld",component:N}]});n.a.config.productionTip=!1,new n.a({el:"#app",router:y,components:{App:s},template:"<App/>"})},YbIk:function(e,t){},vGjf:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.7925613a371e62ec9d29.js.map